{% extends "base.html" %}
{% block title %}Blog{% endblock %}
{% block content %}
<h1 class="center">Blog Posts</h1>

<!-- Search Bar -->
<div class="search-container">
    <input type="text" id="search-input" placeholder="Search blog posts...">
</div>

<!-- Featured Post (latest or pinned) -->
{% if posts and posts[0] %}
<div class="featured-post">
    <h2 class="post-title"><a href="{{ url_for('blog_post', slug=posts[0].slug) }}">{{ posts[0].title }}</a></h2>
    <div class="post-meta">{{ posts[0].date_posted.strftime('%d/%m/%Y') }} | Tags: {{ posts[0].tags }}</div>
    <p class="post-excerpt">{{ posts[0].excerpt or posts[0].content[:200]|striptags }}...</p>
    <a href="{{ url_for('blog_post', slug=posts[0].slug) }}" class="read-more">Read More</a>
</div>
{% endif %}

<div class="blog-grid">
    {% for post in posts %}
    <article class="blog-card searchable-item">
        {% if post.featured_image %}
            <img src="{{ url_for('blog_image', filename=post.featured_image) }}" alt="{{ post.title }}" class="card-image">
        {% endif %}
        <div class="card-content">
            <h2><a href="{{ url_for('blog_post', slug=post.slug) }}">{{ post.title }}</a></h2>
            <div class="post-meta">{{ post.date_posted.strftime('%d/%m/%Y') }}</div>
            <div class="tag-list">
                {% if post.tags %}
                    {% for tag in post.tags.split(',') %}
                        <span class="tag">{{ tag.strip() }}</span>
                    {% endfor %}
                {% endif %}
            </div>
            <p class="post-excerpt">{{ post.excerpt or post.content[:150]|striptags }}...</p>
            <a href="{{ url_for('blog_post', slug=post.slug) }}" class="read-more">Read More</a>
        </div>
    </article>
    {% else %}
    <p class="center">No blog posts yet.</p>
    {% endfor %}
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="{{ url_for('blog', page=pagination.prev_num) }}">&laquo; Previous</a>
    {% endif %}
    {% for page_num in pagination.iter_pages() %}
        {% if page_num %}
            {% if page_num == pagination.page %}
                <strong>{{ page_num }}</strong>
            {% else %}
                <a href="{{ url_for('blog', page=page_num) }}">{{ page_num }}</a>
            {% endif %}
        {% else %}
            <span>...</span>
        {% endif %}
    {% endfor %}
    {% if pagination.has_next %}
        <a href="{{ url_for('blog', page=pagination.next_num) }}">Next &raquo;</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
