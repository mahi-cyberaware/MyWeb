{% extends "base.html" %}
{% block title %}Add Blog Post{% endblock %}
{% block content %}
<div class="form-container">
    <h1 class="center">Add Blog Post</h1>
    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.featured_image.label }}
            {{ form.featured_image(class="form-control-file") }}
        </div>
        <div class="form-group">
            {{ form.title.label }}
            {{ form.title(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.slug.label }}
            {{ form.slug(class="form-control") }}
            <small>URL-friendly version (e.g., my-blog-post)</small>
        </div>
        <div class="form-group">
            {{ form.excerpt.label }}
            {{ form.excerpt(class="form-control", rows=4) }}
        </div>
        <div class="form-group">
            {{ form.content.label }}
            {{ form.content(class="form-control", id="content", rows=15) }}
            <button type="button" id="upload-image-btn" class="btn secondary">Upload Image</button>
            <input type="file" id="image-upload" accept="image/*" style="display:none;">
        </div>
        <div class="form-group">
            {{ form.tags.label }}
            {{ form.tags(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.published() }} {{ form.published.label }}
        </div>
        <button type="submit" class="btn primary">Add Blog Post</button>
    </form>
</div>
<script>
document.getElementById('upload-image-btn').addEventListener('click', function() {
    document.getElementById('image-upload').click();
});
document.getElementById('image-upload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const formData = new FormData();
    formData.append('file', file);
    fetch('/admin/upload-inline-image', { method: 'POST', body: formData })
    .then(r => r.json())
    .then(data => {
        if (data.location) {
            const textarea = document.getElementById('content');
            const markdownImage = `![${file.name}](${data.location})`;
            const start = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, start) + markdownImage + textarea.value.substring(textarea.selectionEnd);
        }
    });
});
</script>
{% endblock %}
